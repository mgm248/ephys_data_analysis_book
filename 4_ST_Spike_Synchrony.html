
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spike Synchrony &#8212; Analysis of Electrophysiological Data in Neuroscience</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Spike Train Analyses" href="3_ST_SpikeTrain_Analyses.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/cpl_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Analysis of Electrophysiological Data in Neuroscience</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Analysis of Electrophysiological Data in Neuroscience
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="0_LFP_Identifying_Oscillations.html">
   Identifying Oscillations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1_LFP_Coherence_Directionality.html">
   Coherence and Directionality
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2_ST_LFP_Spike_LFP_Coupling.html">
   Spike-LFP Coupling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_ST_SpikeTrain_Analyses.html">
   Spike Train Analyses
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Spike Synchrony
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/4_ST_Spike_Synchrony.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F4_ST_Spike_Synchrony.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/4_ST_Spike_Synchrony.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cross-correlation">
   Cross correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unitary-event-analysis">
   Unitary event analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spike-triggered-population-rate">
   Spike-triggered population rate
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#controlling-for-firing-rate">
     Controlling for firing rate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convolution-of-a-cross-correlation">
   Convolution of a cross correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Spike Synchrony</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cross-correlation">
   Cross correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unitary-event-analysis">
   Unitary event analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spike-triggered-population-rate">
   Spike-triggered population rate
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#controlling-for-firing-rate">
     Controlling for firing rate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convolution-of-a-cross-correlation">
   Convolution of a cross correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="spike-synchrony">
<h1>Spike Synchrony<a class="headerlink" href="#spike-synchrony" title="Permalink to this headline">#</a></h1>
<p>Neural synchronization can facilitate information transfer and the binding of information. Many methods have been employed to quantify nerual synchrony, and no one technique has become widely viewed as the gold-standard. Here, I will illustrate several methods to quantify neural synchrony, specifically:</p>
<ol class="simple">
<li><p>Cross correlation</p></li>
<li><p>Unitary event analysis</p></li>
<li><p>Spike-triggered population rate</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">elephant</span>
<span class="kn">import</span> <span class="nn">quantities</span> <span class="k">as</span> <span class="nn">pq</span>
<span class="kn">from</span> <span class="nn">neo.core</span> <span class="kn">import</span> <span class="n">AnalogSignal</span>
<span class="kn">from</span> <span class="nn">neo</span> <span class="kn">import</span> <span class="n">SpikeTrain</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">quantities</span> <span class="k">as</span> <span class="nn">pq</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">viziphant.unitary_event_analysis</span> <span class="k">as</span> <span class="nn">vue</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span><span class="p">,</span> <span class="n">binom</span>
<span class="kn">from</span> <span class="nn">seaborn</span> <span class="kn">import</span> <span class="n">color_palette</span>
</pre></div>
</div>
</div>
</div>
<p>First, let’s simulate 2 neurons, synchronized to the same underlying oscillation (and consequently, synchronized to each other). Here, we can model this by generating two spike trains from the same underlying rhythmic firing rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1224</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">mean_rate</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">osc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">times</span><span class="p">[:]</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span>
<span class="n">osc_rate</span> <span class="o">=</span> <span class="n">mean_rate</span> <span class="o">*</span> <span class="n">osc</span>
<span class="n">osc_rate</span> <span class="o">+=</span> <span class="n">mean_rate</span> <span class="c1">#make sure rate is always positive</span>
<span class="n">sim_spike_rate</span> <span class="o">=</span> <span class="n">AnalogSignal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">osc_rate</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span>
<span class="n">st1</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_generation</span><span class="o">.</span><span class="n">inhomogeneous_poisson_process</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">sim_spike_rate</span><span class="p">,</span> <span class="n">refractory_period</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
<span class="n">st2</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_generation</span><span class="o">.</span><span class="n">inhomogeneous_poisson_process</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">sim_spike_rate</span><span class="p">,</span> <span class="n">refractory_period</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="cross-correlation">
<h2>Cross correlation<a class="headerlink" href="#cross-correlation" title="Permalink to this headline">#</a></h2>
<p>Generating a cross correleogram is a good first step for assessing possible synchrony between neurons. A cross correlelogram shows the approximate timescale of this synchrony, as well as the rhythm that gives rise to the synchrony. Additionally, a cross correlation is relatively straightforward and common to compute. For more details, see the section on <strong>autocorrelation</strong> in <em>spiketrain_analyses</em>. This is the same analysis, but instead of comparing a spike train with itself, here we’re comparing two spike trains.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spikes1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">st1</span><span class="p">)</span>
<span class="n">spikes2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">st2</span><span class="p">)</span>

<span class="n">binsize</span> <span class="o">=</span> <span class="mf">.005</span>
<span class="n">max_lag</span> <span class="o">=</span> <span class="mf">.1</span>
<span class="n">start_win</span><span class="p">,</span> <span class="n">stop_win</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">max_lag</span><span class="p">,</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">max_lag</span>
<span class="n">histo_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_lag</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">binsize</span><span class="p">)</span>

<span class="n">spike_diffs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spike1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spikes1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">spike1</span><span class="o">&gt;</span><span class="n">start_win</span> <span class="ow">and</span> <span class="n">spike1</span><span class="o">&lt;</span><span class="n">stop_win</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">spike2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spikes2</span><span class="p">):</span>
                <span class="n">spike_diff</span> <span class="o">=</span> <span class="n">spike1</span> <span class="o">-</span> <span class="n">spike2</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spike_diff</span><span class="p">)</span><span class="o">&lt;</span><span class="n">max_lag</span><span class="p">:</span> 
                    <span class="n">spike_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spike1</span> <span class="o">-</span> <span class="n">spike2</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">counts</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">spike_diffs</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">histo_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time lag (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Count&#39;)
</pre></div>
</div>
<img alt="_images/4_ST_Spike_Synchrony_5_1.png" src="_images/4_ST_Spike_Synchrony_5_1.png" />
</div>
</div>
<p>The bin at time lag = 0 can be used to assess synchronization. Here, the spike count at 0 is greater than the overall mean, suggesting these neurons are synchronous.</p>
</section>
<section id="unitary-event-analysis">
<h2>Unitary event analysis<a class="headerlink" href="#unitary-event-analysis" title="Permalink to this headline">#</a></h2>
<p>Unitary event analysis essentially computes the number of synchronous spikes <a class="reference external" href="#references">[1]</a>. Because some number of synchronous spikes are expected by chance, this number is then compared to an ‘expected’ number of spikes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute number of synchronous spikes</span>
<span class="n">binned_st1</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">BinnedSpikeTrain</span><span class="p">(</span><span class="n">st1</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span> <span class="c1">#Binarize spike train</span>
<span class="n">binned_st2</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">BinnedSpikeTrain</span><span class="p">(</span><span class="n">st2</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span> <span class="c1">#Binarize spike train</span>

<span class="n">sync_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">binned_st1</span><span class="o">.</span><span class="n">to_bool_array</span><span class="p">(),</span><span class="n">binned_st2</span><span class="o">.</span><span class="n">to_bool_array</span><span class="p">())</span> <span class="c1">#Find where spikes occurred in both spiketrains</span>
<span class="n">n_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sync_events</span><span class="p">)</span>
<span class="n">n_bins</span> <span class="o">=</span> <span class="n">sync_events</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of bins: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_bins</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of synchronous events: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_events</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of bins: 400
Number of synchronous events: 43
</pre></div>
</div>
</div>
</div>
<p>Now, let’s compare this number with how much we would expect by chance. There are a few ways to compute this. Analytically,  we have two spike trains with a mean rate of 60Hz. Therefore, each neuron spikes .3 times per 5ms, and for any 5ms bin, the probability of both neurons spiking is .09. We can calculate the probability that we observe 43 synchronous events or greater using a binomial distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analytic</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">binom</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">n_events</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="mf">.09</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Analytic probability: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Analytic probability: 0.09754615335115961
</pre></div>
</div>
</div>
</div>
<p>Though simple and efficient, this method works only when the firing rate of neurons is stationary over time. However, the firing rate of neurons can change over time, in ways that are correlated with one another that may be spurious to this analysis. This can occur with the onset of a stimulus, or a neuromodulator.</p>
<p>To deal with non-stationarities, there are several methods to create surrogate spike trains, which the actual number of synchronous events can be compared with <a class="reference external" href="#references">[2]</a>. Surrogates are commonly created by dithering (or jittering) a spike train by randomly moving each spike by some time within some small time frame. Alternatively, surrogates can be created by randomly shifting spike trains against each other, conserving the original structure of each spike train but requiring ultimately large time shifts. Finally, when analyzing synchrony evoked by a stimulus, spike trains can be shifted across trials, such that the number of synchronous events can be compared with the number of synchronous events found when comparing neurons recorded in different trials. However, this analysis assumes stationarity can be assumed across trials, which is generally unlikely.</p>
<p>Here, let’s dither to create surrogate spike trains, and compare the actual number of synchronous events with this distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare with surrogate spike trains</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">surr_evts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">surr_sts</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_surrogates</span><span class="o">.</span><span class="n">dither_spikes</span><span class="p">(</span><span class="n">st2</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">n_surrogates</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">for</span> <span class="n">surr_st</span> <span class="ow">in</span> <span class="n">surr_sts</span><span class="p">:</span>
    <span class="n">binned_surr_st</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">BinnedSpikeTrain</span><span class="p">(</span><span class="n">surr_st</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span> <span class="c1">#Binarize spike train</span>
    <span class="n">sync_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">binned_st1</span><span class="o">.</span><span class="n">to_bool_array</span><span class="p">(),</span><span class="n">binned_surr_st</span><span class="o">.</span><span class="n">to_bool_array</span><span class="p">())</span> <span class="c1">#Find where spikes occurred in both spiketrains</span>
    <span class="n">surr_evts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sync_events</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Michael\anaconda3\envs\tutorials\lib\site-packages\quantities\quantity.py:337: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  return np.multiply(other, self)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">surr_evts</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">n_events</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# synchronous events&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">n_events</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;Actual # events&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_events</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">surr_evts</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">surr_evts</span><span class="p">)</span>

<span class="n">dith_p</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">z_score</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dithered probability: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dith_p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dithered probability: 0.10832211715896994
</pre></div>
</div>
<img alt="_images/4_ST_Spike_Synchrony_13_1.png" src="_images/4_ST_Spike_Synchrony_13_1.png" />
</div>
</div>
<p>Now, let’s simulate two spike trains that only become synchronous after 1s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">mean_rate</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">osc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">times</span><span class="p">[:]</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span>
<span class="n">osc_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
<span class="n">osc_rate</span><span class="p">[</span><span class="mi">1000</span><span class="p">:]</span> <span class="o">=</span> <span class="n">mean_rate</span> <span class="o">*</span> <span class="n">osc</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
<span class="n">osc_rate</span> <span class="o">+=</span> <span class="n">mean_rate</span> <span class="c1">#make sure rate is always positive</span>
<span class="n">sim_spike_rate</span> <span class="o">=</span> <span class="n">AnalogSignal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">osc_rate</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span>
<span class="n">st1</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_generation</span><span class="o">.</span><span class="n">inhomogeneous_poisson_process</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">sim_spike_rate</span><span class="p">,</span> <span class="n">refractory_period</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
<span class="n">st2</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_generation</span><span class="o">.</span><span class="n">inhomogeneous_poisson_process</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">sim_spike_rate</span><span class="p">,</span> <span class="n">refractory_period</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can calculate how synchrony changes over time using elephant’s jointJ_window_analysis function, and plot it using the plot_ue function from viziphant (elephant’s companion visualization package).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spiketrains</span> <span class="o">=</span> <span class="p">[[</span><span class="n">st1</span><span class="p">,</span> <span class="n">st2</span><span class="p">]]</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">UEs</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">unitary_event_analysis</span><span class="o">.</span><span class="n">jointJ_window_analysis</span><span class="p">(</span><span class="n">spiketrains</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">winsize</span><span class="o">=</span><span class="mi">500</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">winstep</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">pattern_hash</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vue</span><span class="o">.</span><span class="n">plot_ue</span><span class="p">(</span><span class="n">spiketrains</span><span class="p">,</span> <span class="n">UEs</span><span class="p">,</span> <span class="n">significance_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FigureUE(axes_spike_events=&lt;AxesSubplot: title={&#39;center&#39;: &#39;Spike Events&#39;}, ylabel=&#39;Trial&#39;&gt;, axes_spike_rates=&lt;AxesSubplot: title={&#39;center&#39;: &#39;Spike Rates&#39;}, ylabel=&#39;Hz&#39;&gt;, axes_coincident_events=&lt;AxesSubplot: title={&#39;center&#39;: &#39;Coincident Events&#39;}, ylabel=&#39;Trial&#39;&gt;, axes_coincidence_rates=&lt;AxesSubplot: title={&#39;center&#39;: &#39;Coincidence Rates&#39;}, ylabel=&#39;Hz&#39;&gt;, axes_significance=&lt;AxesSubplot: title={&#39;center&#39;: &#39;Statistical Significance&#39;}&gt;, axes_unitary_events=&lt;AxesSubplot: title={&#39;center&#39;: &#39;Unitary Events&#39;}, xlabel=&#39;Time (ms)&#39;, ylabel=&#39;Trial&#39;&gt;)
</pre></div>
</div>
<img alt="_images/4_ST_Spike_Synchrony_18_1.png" src="_images/4_ST_Spike_Synchrony_18_1.png" />
</div>
</div>
<p>Elephant’s visualization shows many coincident events. Additionally, the actual coincidence rate is generally higher than the expected, as calculated analytically. However, the windows only reach significance around 1s, and only coincident events in these windows are marked as unitary events.</p>
</section>
<section id="spike-triggered-population-rate">
<h2>Spike-triggered population rate<a class="headerlink" href="#spike-triggered-population-rate" title="Permalink to this headline">#</a></h2>
<p>Alternatively, spike-spike synchrony can be computed as the spike-triggered population rate (stPR), or the firing rate of other neurons when one neuron fires <a class="reference external" href="#references">[3]</a>. This method has several advantages. First, the method can be used to test the synchrony between one neuron and a population of neurons. Therefore, when analyzing the general synchrony of each neuron, rather than neuron synchrony between individual neurons, this method can be much more efficient. Additionally, as demonstrated later, this method does not require the generation of surrogate neural spiketrains to control for a non-stationary spikerate. As a result, this method can be much more computationally efficient in analyzing the neural synchrony between a neuron and a population of neurons. Finally, this method provides a synchrony value for each spike, rather than for a given window of time, allowing for finer time resolution in analyzing synchrony.</p>
<p>To illustrate this method, we’ll start off by simulating a neuron, and a neural population, each firing in a synchronized rhythm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Simulate a neuron, and a neural population</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">mean_rate</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">osc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">times</span><span class="p">[:]</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span>
<span class="n">osc_rate</span> <span class="o">=</span> <span class="n">mean_rate</span> <span class="o">*</span> <span class="n">osc</span>
<span class="n">osc_rate</span> <span class="o">+=</span> <span class="n">mean_rate</span> <span class="c1">#make sure rate is always positiv</span>
<span class="n">sim_spike_rate</span> <span class="o">=</span> <span class="n">AnalogSignal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">osc_rate</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span>
<span class="n">st2</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_generation</span><span class="o">.</span><span class="n">inhomogeneous_poisson_process</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">sim_spike_rate</span><span class="p">,</span> <span class="n">refractory_period</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>

<span class="n">n_pop_neurons</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">st_pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_pop_neurons</span><span class="p">):</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_generation</span><span class="o">.</span><span class="n">inhomogeneous_poisson_process</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">sim_spike_rate</span><span class="p">,</span> <span class="n">refractory_period</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
    <span class="n">st_pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">st_pop</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">st</span><span class="p">)))</span>
    
<span class="n">st_pop</span> <span class="o">=</span> <span class="n">SpikeTrain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">st_pop</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">pq</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">t_stop</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>   
</pre></div>
</div>
</div>
</div>
<p>Then, calculate the stPR, the mean firing rate of the population when neuron 2 fires.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculate stPR (uncorrected)</span>
<span class="n">spike_sr</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">GaussianKernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">instantaneous_rate</span><span class="p">(</span><span class="n">st_pop</span><span class="p">,</span> <span class="n">sampling_period</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">spike_sr</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
                                              <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">center_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">/</span> <span class="n">n_pop_neurons</span>
<span class="n">stPRs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">spikes2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">st2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="n">spikes2</span><span class="p">:</span>
    <span class="n">stPRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rate</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spike</span> <span class="o">*</span> <span class="n">spike_sr</span><span class="p">,</span> <span class="mi">4</span><span class="p">))]))</span>
    
<span class="n">mean_stPR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stPRs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean firing rate: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rate</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean stPR: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_stPR</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">Hz</span><span class="p">))</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean firing rate: 59.576873252977244 Hz
Mean stPR: 66.67997370011862 Hz
</pre></div>
</div>
</div>
</div>
<p>The spike-triggered firing rate is greater than the overall mean firing rate, meaning neuron 2 is more likely to fire around when neurons in the population are firing relatively more.</p>
<p>Additionally, for each spike, we can get the firing rate in a surrounding window of time. This will allow us to see at what timescale the firing rate of neuron 1 increases when neuron 2 fires.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spike_sr</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">GaussianKernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">instantaneous_rate</span><span class="p">(</span><span class="n">st_pop</span><span class="p">,</span> <span class="n">sampling_period</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">spike_sr</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
                                              <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">center_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">/</span> <span class="n">n_pop_neurons</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
<span class="n">stPR_segs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">spikes2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">st2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="n">spikes2</span><span class="p">:</span>
    <span class="n">spike</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">spike</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spike</span> <span class="o">&gt;</span> <span class="n">window</span><span class="o">/</span><span class="n">spike_sr</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">spike</span> <span class="o">&gt;</span> <span class="n">window</span><span class="o">/</span><span class="n">spike_sr</span><span class="p">:</span> <span class="c1">#If window entirely within times analyzed</span>
        <span class="n">rate_seg</span> <span class="o">=</span> <span class="n">rate</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spike</span><span class="o">*</span><span class="n">spike_sr</span><span class="p">))</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">window</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spike</span><span class="o">*</span><span class="n">spike_sr</span><span class="p">))</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">window</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">stPR_segs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate_seg</span><span class="p">)</span>
    
<span class="n">stPRs_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stPR_segs</span><span class="p">)</span>
<span class="n">stPRs_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">stPRs_arr</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">window</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stPRs_arr</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time lag (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Population firing rate (Hz)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Population firing rate (Hz)&#39;)
</pre></div>
</div>
<img alt="_images/4_ST_Spike_Synchrony_25_1.png" src="_images/4_ST_Spike_Synchrony_25_1.png" />
</div>
</div>
<p>We have essentially created a cross correlation figure, using the firing rate of unit 1.</p>
<section id="controlling-for-firing-rate">
<h3>Controlling for firing rate<a class="headerlink" href="#controlling-for-firing-rate" title="Permalink to this headline">#</a></h3>
<p>However, this method is biased by the mean firing rate of the population: if neurons fire more in general, the stPR will be higher. Thus, just as with unitary event analysis, we need to find a method to control for the overall firing rate of the population.</p>
<p>In the original paper for this method, the authors did so via a shuffling method. Though their exact method does not suit our data, we can implement something similar by comparing with surrogate spike trains as we did before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Surrogate vs. real stPR</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">surr_stPRs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">surr_sts</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">spike_train_surrogates</span><span class="o">.</span><span class="n">dither_spikes</span><span class="p">(</span><span class="n">st2</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">n_surrogates</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">for</span> <span class="n">surr_st</span> <span class="ow">in</span> <span class="n">surr_sts</span><span class="p">:</span>
    <span class="n">stPRs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">surr_spikes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">surr_st</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="n">surr_spikes</span><span class="p">:</span>
        <span class="n">stPRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rate</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spike</span> <span class="o">*</span> <span class="n">spike_sr</span><span class="p">,</span> <span class="mi">4</span><span class="p">))]))</span>
    <span class="n">surr_stPRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stPRs</span><span class="p">))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">surr_stPRs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_stPR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;stPR&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">mean_stPR</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;Actual stPR&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_stPR</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">surr_stPRs</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">surr_stPRs</span><span class="p">)</span>

<span class="n">dith_p</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">z_score</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dithered probability: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dith_p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dithered probability: 3.5099805001481054e-08
</pre></div>
</div>
<img alt="_images/4_ST_Spike_Synchrony_28_1.png" src="_images/4_ST_Spike_Synchrony_28_1.png" />
</div>
</div>
<p>Alternatively, we can control for the overall firing rate of the population (and its nonstationarities) in our measurement of the firing rate itself. We can isolate the fine-timescale deviations from the mean firing rate by substracting out the longer-timescale estimate of firing rate. Specifically, this method measures firing rate on a fine time-scale using a narrow kernel, and subtracts the firing rate measured on a slow timescale from this firing rate.</p>
<p>First, let’s isolate the fine-timescale fluctuations of the population by substracting out a longer-timescale estimate of firing rate. We’ll add a simulation of a slow fluctuation in firing rate, to illustrate how we can remove it with this analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Isolate fine-timescale firing rate fluctuations</span>
<span class="n">fast_kernel_sigma</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">slow_kernel_sigma</span> <span class="o">=</span> <span class="mi">11</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">fastk</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">GaussianKernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">fast_kernel_sigma</span><span class="p">)</span>
<span class="n">slowk</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">GaussianKernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">slow_kernel_sigma</span><span class="p">)</span>

<span class="n">fast_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elephant</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">instantaneous_rate</span><span class="p">(</span><span class="n">st_pop</span><span class="p">,</span> <span class="n">sampling_period</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">spike_sr</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
                                                       <span class="n">kernel</span><span class="o">=</span><span class="n">fastk</span><span class="p">,</span> <span class="n">center_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">slow_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elephant</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">instantaneous_rate</span><span class="p">(</span><span class="n">st_pop</span><span class="p">,</span> <span class="n">sampling_period</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">spike_sr</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
                                                       <span class="n">kernel</span><span class="o">=</span><span class="n">slowk</span><span class="p">,</span> <span class="n">center_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">fast_rate</span> <span class="o">/=</span> <span class="n">n_pop_neurons</span>
<span class="n">slow_rate</span> <span class="o">/=</span> <span class="n">n_pop_neurons</span>
<span class="n">fast_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">fast_rate</span><span class="p">)</span>
<span class="n">slow_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">slow_rate</span><span class="p">)</span>
<span class="n">freq</span><span class="o">=</span><span class="mi">1</span>
<span class="n">osc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">times</span><span class="p">[:]</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span>
<span class="n">fast_rate</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">osc</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span> <span class="c1">#Add general drift to the firing rates</span>
<span class="n">slow_rate</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">osc</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span> <span class="c1">#Add general drift to the firing rates</span>
<span class="n">diff_rate</span> <span class="o">=</span> <span class="n">fast_rate</span> <span class="o">-</span> <span class="n">slow_rate</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;flare&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">11.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">fast_rate</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fast rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">slow_rate</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;slow rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">diff_rate</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;fast - slow&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Firing rate (Hz)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Firing rate (Hz)&#39;)
</pre></div>
</div>
<img alt="_images/4_ST_Spike_Synchrony_30_1.png" src="_images/4_ST_Spike_Synchrony_30_1.png" />
</div>
</div>
<p>The fine-timescale kernel firing rate tracks the high frequency oscillation, while the slow-timescale kernel does not. Still, the slow kernel tracks the non-stationary firing rate. Substracting this from the fast kernel removes the slower drift in our data. Now, firing rate has a mean of 0, and positive values indicate a relative increase in firing rate, while negative values indicate the reverse. Now, we can calculate the stPR on this difference.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stPRs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">spikes2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">st2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="n">spikes2</span><span class="p">:</span>
    <span class="n">stPRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">diff_rate</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spike</span> <span class="o">*</span> <span class="n">spike_sr</span><span class="p">,</span> <span class="mi">4</span><span class="p">))]))</span>
    
<span class="n">mean_stPR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stPRs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean firing rate: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff_rate</span><span class="p">)</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">Hz</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean stPR: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_stPR</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">Hz</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean firing rate: 0.18442787923700246 Hz
Mean stPR: 16.170752011037074 Hz
</pre></div>
</div>
</div>
</div>
<p>The stPR is much higher than 0, indicating the neuron is synchronous with the population. Notably, unlike the other methods, this analysis does not provide a significance value. Still, these values can be compared between neurons, or with a baseline.</p>
<p><strong>Kernel Design</strong></p>
<p>We can get a more exact idea of what firing rate changes this timescale is estimating by plotting how each kernel estimates the firing rate of a single spike.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Kernel design</span>
<span class="n">fast_kernel_sigma</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">slow_kernel_sigma</span> <span class="o">=</span> <span class="mi">11</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">spiketrain</span> <span class="o">=</span> <span class="n">SpikeTrain</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">t_start</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">t_stop</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">time_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1001</span><span class="p">)</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">GaussianKernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">fast_kernel_sigma</span><span class="p">)</span>
<span class="n">fast_kernel_time</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">(</span><span class="n">time_array</span><span class="p">)</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">elephant</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">GaussianKernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">slow_kernel_sigma</span><span class="p">)</span>
<span class="n">slow_kernel_time</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">(</span><span class="n">time_array</span><span class="p">)</span>


<span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;flare&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">11.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">fast_kernel_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">slow_kernel_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">fast_kernel_sigma</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; kernel&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">slow_kernel_sigma</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; kernel&#39;</span><span class="p">,</span> <span class="s1">&#39;Difference&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time, ms&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;kernel, 1/ms&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">fast_kernel_time</span><span class="o">-</span><span class="n">slow_kernel_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time, ms&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;kernel, 1/ms&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Difference&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x21f5ffc3850&gt;
</pre></div>
</div>
<img alt="_images/4_ST_Spike_Synchrony_35_1.png" src="_images/4_ST_Spike_Synchrony_35_1.png" />
</div>
</div>
<p>The narrower kernel results in an estimatation of firing rate that only increases immediately surrounding the spike, but increases to a much higher degree. Specifically, using a 3ms and 11ms sigma for the fine and slow time-scale kernels, respectively, the fine-timescale firing rate is increased in the 10ms surrounding the spike, but decreased in the remaining 60ms. Therefore, this metric will be positive when the difference between two spike times is less than 5ms, or negative when the difference is between 5 and ~30ms.</p>
<p>Using this method, the timescales of the kernels should be carefully designed to reflect what the study would like to define as synchrony, and what general fluctuations should be removed.</p>
</section>
</section>
<section id="convolution-of-a-cross-correlation">
<h2>Convolution of a cross correlation<a class="headerlink" href="#convolution-of-a-cross-correlation" title="Permalink to this headline">#</a></h2>
<p>Other studies have convolved the cross correlation histogram, rather than the spike trains themselves, to estimate synchrony. Specifically, after a cross correlelogram has been computed, slower covariations in firing rate are estimated by convolving the cross correlelogram with a gaussian kerenel. The significance of each bin can then be compared to the convolved correlelogram, asssuming a poisson distribution <a class="reference external" href="#references">[4]</a>. This method therefore allows for the estimation of significance without jittering. Additionally, this method can also be applied towards identifying peaks in the cross correlelogram at time lags other than 0, for example, to identify a monosynaptic connection between neurons from a peak at +3ms <a class="reference external" href="#references">[5]</a>. However, the time resolution of this method is limited, as a cross correlelogram must be computed with a sufficent time window to include a reasonable estimate of the distribution at various time lags. This method has not been used by our lab, but the Buzsaki lab has published <a class="reference external" href="#https://github.com/AntonioFR8/buzcodeAFR/blob/devAFR/analysis/monosynapticPairs/bz_GetMonoSynapticallyConnected.m">example code</a> on Github.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>Grün, S., Diesmann, M., Grammont, F., Riehle, A., &amp; Aertsen, A. (1999). Detecting unitary events without discretization of time. Journal of neuroscience methods, 94(1), 67-79</p></li>
<li><p>Grün, S. (2009). Data-driven significance estimation for precise spike correlation. Journal of Neurophysiology, 101(3), 1126–1140. <a class="reference external" href="https://doi.org/10.1152/jn.00093.2008G">https://doi.org/10.1152/jn.00093.2008G</a></p></li>
<li><p>Okun, M., Steinmetz, N. A., Cossell, L., Iacaruso, M. F., Ko, H., Barthó, P., Moore, T., Hofer, S. B., Mrsic-Flogel, T. D., Carandini, M., &amp; Harris, K. D. (2015). Diverse coupling of neurons to populations in sensory cortex. Nature, 521(7553), 511. <a class="reference external" href="https://doi.org/10.1038/NATURE14273">https://doi.org/10.1038/NATURE14273</a></p></li>
<li><p>Stark, E., &amp; Abeles, M. (2009). Unbiased estimation of precise temporal correlations between spike trains. Journal of Neuroscience Methods, 179(1), 90–100. <a class="reference external" href="https://doi.org/10.1016/J.JNEUMETH.2008.12.029">https://doi.org/10.1016/J.JNEUMETH.2008.12.029</a></p></li>
<li><p>English, D. F., McKenzie, S., Evans, T., Kim, K., Yoon, E., &amp; Buzsáki, G. (2017). Pyramidal cell-interneuron circuit architecture and dynamics in hippocampal networks. Neuron, 96(2), 505. <a class="reference external" href="https://doi.org/10.1016/J.NEURON.2017.09.033">https://doi.org/10.1016/J.NEURON.2017.09.033</a></p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="3_ST_SpikeTrain_Analyses.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Spike Train Analyses</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael Mariscal<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>